angular.module("ngSharepoint.Lists",["ngSharepoint"]),angular.module("ngSharepoint.Lists").factory("DeleteQuery",["$spList","CamlBuilder","WhereQuery","Query",function(a,b,c,d){var e=function(){return this.__where=[],this.__list=null,this};return e.prototype=new d,e.prototype.from=function(a){return this.__list=a,this},e.prototype.where=function(a){var b=new c(this,a);return this.__where.push(b),b},e.prototype.__execute=function(){var c,d=new b,e=d.push("View");if(1===this.__where.length)c=e.push("Query"),this.__where[0].push(c.push("Where"));else if(this.__where.length>1){c=e.push("Query");var f=c.push("Where").push("And");this.__where.forEach(function(a){a.push(f)})}return a.getList(this.__list)["delete"](d.build())},e}]),angular.module("ngSharepoint.Lists").factory("InsertIntoQuery",["$spList","Query",function(a,b){var c=function(a){return this.__list=a,this.__values={},this};return c.prototype=new b,c.prototype.value=function(a,b){return this.__values[a]=b,this},c.prototype.__execute=function(){return a.getList(this.__list).insert(this.__values)},c}]),angular.module("ngSharepoint.Lists").factory("JoinQuery",["$q","$sp",function(a,b){var c=function(){};return c}]),angular.module("ngSharepoint.Lists").factory("Query",function(){var a=function(){};return a.prototype.unpackItem=function(a){var b=this,c={};return Array.isArray(b.__values)?b.__values.forEach(function(d){var e=a.get_item(d);c[d]=b.__trim(e)}):Object.getOwnPropertyNames(b.__values).forEach(function(d){var e=a.get_item(d);c[d]=b.__trim(e)}),c},a.prototype.packItem=function(a){var b=this;Object.getOwnPropertyNames(b.__values).forEach(function(c){a.set_item(c,b.__trim(b.__values[c]))})},a.prototype.then=function(a,b){return this.__execute().then(a,b)},a.prototype.__trim=function(a){return null!==a&&void 0!==a&&"string"==typeof a?a.trim():a},a}),angular.module("ngSharepoint.Lists").factory("SelectQuery",["$spList","CamlBuilder","Query","WhereQuery",function(a,b,c,d){var e=function(a){return this.__values=a,this.__where=[],this.__limit=null,this.__order=[],this};return e.prototype=new c,e.prototype.from=function(a){return this.__list=a,this},e.prototype.where=function(a){var b=new d(this,a);return this.__where.push(b),b},e.prototype.limit=function(a){return this.__limit=a,this},e.prototype.orderBy=function(a,b){return angular.isUndefined(b)&&(b=!0),this.__order.push({field:a,asc:b}),this},e.prototype.__execute=function(){var c=new b,d=c.push("View");if(query.__where.length>0||query.__order.length>0){var e=d.push("Query");if(1===query.__where.length){var f=e.push("Where");query.__where[0].push(f)}else if(query.__where.length>1){var g=e.push("Where").push("And");query.__where.forEach(function(a){a.push(g)})}if(query.__order.length>0){var h=e.push("OrderBy");query.__order.forEach(function(a){h.push("FieldRef",{Name:a.field,Ascending:a.asc})})}}var i=d.push("ViewFields");return query.__values.forEach(function(a){i.push("FieldRef",{Name:a})}),null!==query.__limit&&d.push("RowLimit",{},query.__limit),a.getList(this.__list).select(c.build())},e}]),angular.module("ngSharepoint.Lists").factory("UpdateQuery",["$spList","CamlBuilder","WhereQuery","Query",function(a,b,c,d){var e=function(a){return this.__list=a,this.__values={},this.__where=[],this};return e.prototype=new d,e.prototype.set=function(a,b){return this.__values[a]=b,this},e.prototype.where=function(a){var b=new c(this,a);return this.__where.push(b),b},e.prototype.__execute=function(){var c,d=new b,e=d.push("View");if(1===query.__where.length)c=e.push("Query"),query.__where[0].push(c.push("Where"));else if(query.__where.length>1){c=e.push("Query");var f=c.push("Where").push("And");query.__where.forEach(function(a){a.push(f)})}return a.getList(this.__list).update(d.build(),this.__values)},e}]),angular.module("ngSharepoint.Lists").factory("WhereQuery",function(){var a=function(a,b){this.__query=a,this.__value="",this.__operator="",this.__operators={BEGINS_WITH:["<BeginsWith>","</BeginsWith>"],CONTAINS:["<Contains>","</Contains>"],EQUALS:["<Eq>","</Eq>"],GREATER_EQUALS:["<Geq>","</Geq>"],GREATER:["<Gt>","</Gt>"],INCLUDES:["<Includes>","</Includes>"],IS_NOT_NULL:["<IsNotNull>","</IsNotNull>"],IS_NULL:["<IsNull>","</IsNull>"],LESS_EQUALS:["<Leq>","</Leq>"],LESS:["<Lt>","</Lt>"],NOT_EQUALS:["<Neq>","</Neq>"],NOT_INCLUDES:["<NotIncludes>","</NotIncludes>"]},"string"==typeof b?this.__field=b:(this.__fields=b,this.__operator="equals")};return a.prototype.equals=function(a){return this.__operator="equals",this.__value=a,this.__query},a.prototype.beginsWith=function(a){this.__operator=this.__operators.BEGINS_WITH},a.prototype.push=function(a){var b=this;if(angular.isUndefined(b.__fields)){var c;switch(b.__operator){case"equals":c=a.push("Eq")}c.push("FieldRef",{Name:b.__field}),c.push("Value",{Type:"Number"},b.__value)}else{var d=a.push("And");Object.getOwnPropertyNames(b.__fields).forEach(function(a){var c=d.push("Eq");c.push("FieldRef",{Name:a}),c.push("Value",{Type:"Number"},b.__fields[a])})}},a}),angular.module("ngSharepoint.Lists").factory("JsomSPList",["$q","$sp",function(a,b){var c=function(a){this.title=a};return c.prototype.select=function(c){var d=this;return a(function(a,e){var f=b.getContext(),g=f.get_web().get_lists().getByTitle(d.title),h=new SP.CamlQuery;h.set_viewXml(c);var i=g.getItems(h);f.load(i),f.executeQueryAsync(function(){for(var b=[],d=i.getEnumerator();d.moveNext();){var e=d.get_current();b.push(g.__unpack(e,$spCamlParser.parse(c).getViewFields()))}a(b)},function(a,b){e(b)})})},c.prototype.insert=function(c){var d=this;return a(function(a,e){var f=b.getContext(),g=f.get_web().get_lists().getByTitle(d.title),h=new SP.ListItemCreationInformation,i=g.addItem(h);g.__pack(i,c),i.update(),f.load(i),f.executeQueryAsync(function(b,d){a(c)},function(a,b){e(b)})})},c.prototype["delete"]=function(c){var d=this;return a(function(a,e){var f=b.getContext(),g=f.get_web().get_lists().getByTitle(d.title),h=new SP.CamlQuery;h.set_viewXml(c);var i=g.getItems(h);f.load(i),f.executeQueryAsync(function(b,c){for(var d=i.getEnumerator(),g=[];d.moveNext();){var h=d.get_current();g.push(h)}g.forEach(function(a){a.deleteObject()}),f.executeQueryAsync(function(b,c){a(c)},function(a,b){e(b)})},function(a,b){e(b)})})},c.prototype.update=function(c,d){return a(function(a,e){var f=b.getContext(),g=f.get_web().get_lists().getByTitle(c.__list),h=new SP.CamlQuery;h.set_viewXml(c);var i=g.getItems(h);f.load(i),f.executeQueryAsync(function(b,c){for(var h=i.getEnumerator();h.moveNext();){var j=h.get_current();g.__pack(j,d),j.update()}f.executeQueryAsync(function(b,c){a(c)},function(a,b){e(b)})},function(a,b){e(b)})})},c.prototype.__pack=function(a,b){Object.getOwnPropertyNames(b).forEach(function(c){var d=b[c];null!==d&&void 0!==d&&"string"==typeof d&&(d=d.trim()),a.set_item(c,d)})},c.prototype.__unpack=function(a,b){var c={},d=b;return Array.isArray(b)||(d=Object.getOwnPropertyNames(b)),d.forEach(function(b){var d=a.get_item(b);null!==d&&void 0!==d&&"string"==typeof d&&(d=d.trim()),c[b]=d}),c},c}]),angular.module("ngSharepoint.Lists").factory("RestSPList",["$q","$sp","$http",function(a,b,c){var d=function(a){this.title=a};return d.prototype.select=function(d){var e="_api/web/Lists/GetByTitle('"+this.title+"')/GetItems",f={query:{__metadata:{type:"SP.CamlQuery"},ViewXml:d}},g={"X-RequestDigest":$("#__REQUESTDIGEST").val(),Accept:"application/json; odata=verbose","Content-Type":"application/json; odata=verbose"};return a(function(a,d){c({method:"POST",url:b.getSiteUrl()+e,data:f,headers:g}).then(function(a){},d)})},d.prototype.insert=function(d){var e="_api/web/Lists/GetByTitle('"+this.title+"')/items",f={__metadata:{type:"SP.Data.TestListItem"}},g={"X-RequestDigest":$("#__REQUESTDIGEST").val(),Accept:"application/json; odata=verbose","Content-Type":"application/json; odata=verbose"};return Object.getOwnPropertyNames(d).forEach(function(a){var b=d[a];null!==b&&void 0!==b&&"string"==typeof b&&(b=b.trim()),f[a]=b}),a(function(a,d){c({method:"POST",url:b.getSiteUrl()+e,data:f,headers:g}).then(function(a){},d)})},d.prototype["delete"]=function(a){},d.prototype.update=function(a,b){},d}]),angular.module("ngSharepoint.Lists").factory("SPList",["$sp","$spLog","RestSPList","JsomSPList",function(a,b,c,d){var e=function(b){this.title=b,"JSOM"===a.getConnectionMode()?this.__list=new d(b):this.__list=new c(b)};return e.prototype.insert=function(a){return this.__list.insert(a)["catch"](b.error)},e.prototype.select=function(a){return this.__list.select(a)["catch"](b.error)},e.prototype["delete"]=function(a){return this.__list["delete"](a)["catch"](b.error)},e.prototype.update=function(a,c){return this.__list.update(a,c)["catch"](b.error)},e}]),angular.module("ngSharepoint.Lists").directive("spList",["$spList",function(a){return{restrict:"A",scope:{spList:"@",select:"=spSelect",where:"=spWhere",limit:"=spLimit",order:"=spOrder",asc:"=spAsc"},transclude:!0,template:'<div ng-repeat="item in items" ng-transclude></div>',controller:function(){angular.isUndefined($scope.select)&&($scope.select="*"),angular.isUndefined($scope.asc)&&($scope.asc=!0);var b=a.select($scope.select);angular.isDefined($scope.where)&&b.where($scope.where),angular.isDefined($scope.limit)&&b.limit($scope.limit),angular.isDefined($scope.order)&&b.orderBy($scope.order,$scope.asc),b.then(function(a){$scope.items=a},function(a){console.error(a)})}}}]),angular.module("ngSharepoint.Lists").factory("$spList",["SPList","SelectQuery","UpdateQuery","InsertIntoQuery","DeleteQuery",function(a,b,c,d,e){return{getList:function(b){return new a(b)},select:function(a){return new b(a)},update:function(a){return new c(a)},insertInto:function(a){return new d(a)},"delete":function(){return new e}}}]);