angular.module("ngSharepoint.Users",["ngSharepoint"]).run(["$sp","$spLoader",function(a,b){a.getAutoload()&&"JSOM"===a.getConnectionMode()&&b.loadScript("SP.Userprofiles.js")}]),angular.module("ngSharepoint.Users").directive("spUser",["$spUser",function(a){return{restrict:"E",scope:{name:"@"},transclude:!0,template:"<div ng-transclude></div>",link:function(b,c,d){b.$watch(d.name,function(c){a.getUser(c).then(function(a){b.user=a})})}}}]),angular.module("ngSharepoint.Users").factory("SPUser",["$q","$spLoader","$sp",function(a,b,c){var d=function(b,d){var g=this;return angular.isUndefined(d)&&(d=!0),g.accountName=b,"JSOM"===c.getConnectionMode()?g.__list=new e(b):g.__list=new f(b),d?a(function(a,b){g.load().then(function(a){g.displayName=a.displayName,g.email=a.email,g.picture=a.picture,g.title=a.title,g.personalUrl=a.personalUrl,g.userUrl=a.userUrl,g.properties=a.properties}).then(a,b)}):g};d.prototype.load=function(){return this.__list.load()};var e=function(a){this.accountName=a};e.prototype.load=function(){var d=this;return a(function(a,e){b.waitUntil("SP.Userprofiles.js").then(function(){var b=c.getContext(),f=new SP.UserProfiles.PeopleManager(b),g=f.getPropertiesFor(d.accountName);b.load(g),b.executeQueryAsync(function(){var b={};b.displayName=g.get_displayName(),b.email=g.get_email(),b.picture=g.get_pictureUrl(),b.title=g.get_title(),b.personalUrl=g.get_personalUrl(),b.userUrl=g.get_userUrl(),a(b)},e)})})};var f=function(a){this.accountName=a};f.prototype.load=function(){var c=this,d="_api/SP.UserProfiles.PeopleManager/getPropertiesFor(@account)?@account='"+c.accountName+"'";return a(function(a,c){b({method:"GET",url:d}).then(function(b){var c={};c.displayName=b.d.DisplayName,c.email=b.d.Email,c.picture=b.d.PictureUrl,c.title=b.d.Title,c.personalUrl=b.d.PersonalUrl,c.userUrl=b.d.UserUrl,a(c)},c)})}}]),angular.module("ngSharepoint.Users").provider("$spUser",["$q","$sp","SPUser",function(a,b,c){return{$get:["$q","$sp",function(a,b){return{getCurrentUser:function(){return a(function(a,c){var d=b.getContext(),e=new SP.UserProfiles.PeopleManager(d),f=e.getMyProperties();d.load(f),d.executeQueryAsync(function(){a(f)},c)})},getUser:function(a){return new c(a)}}}]}}]);