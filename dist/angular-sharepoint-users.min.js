angular.module("ngSharepoint.Users",["ngSharepoint"]),angular.module("ngSharepoint.Users").directive("spUser",["$spUser",function(a){return{restrict:"E",scope:{name:"@"},transclude:!0,template:"<div ng-transclude></div>",link:function(b,c,d){b.$watch(d.name,function(c){a.getUser(c).then(function(a){b.user=a})})}}}]),angular.module("ngSharepoint.Users").factory("SPUser",["$q","$http","$sp",function(a,b,c){var d=function(b,d){var g=this;return angular.isUndefined(d)&&(d=!0),g.accountName=b,"JSOM"===c.getConnectionMode()?g.__list=new e(b):g.__list=new f(b),d?a(function(a,b){g.load().then(function(a){g.displayName=a.displayName,g.email=a.email,g.picture=a.picture,g.title=a.title,g.personalUrl=a.personalUrl,g.userUrl=a.userUrl,g.properties=a.properties}).then(a,b)}):g};d.prototype.load=function(){return this.__list.load()};var e=function(a){this.accountName=a};e.prototype.load=function(){var b=this;return a(function(a,d){var e=c.getContext(),f=new SP.UserProfiles.PeopleManager(e),g=f.getPropertiesFor(b.accountName);e.load(g),e.executeQueryAsync(function(){var b={};b.displayName=g.get_displayName(),b.email=g.get_email(),b.picture=g.get_pictureUrl(),b.title=g.get_title(),b.personalUrl=g.get_personalUrl(),b.userUrl=g.get_userUrl(),a(b)},d)})};var f=function(a){this.accountName=a};f.prototype.load=function(){var d=this,e="_api/SP.UserProfiles.PeopleManager/getPropertiesFor(@account)?@account='"+d.accountName+"'",f={"X-RequestDigest":$("#__REQUESTDIGEST").val(),Accept:"application/json; odata=verbose","Content-Type":"application/json; odata=verbose"};return a(function(a,d){b({method:"GET",url:c.getSiteUrl()+e,headers:f}).then(function(b){var c={};c.displayName=b.d.DisplayName,c.email=b.d.Email,c.picture=b.d.PictureUrl,c.title=b.d.Title,c.personalUrl=b.d.PersonalUrl,c.userUrl=b.d.UserUrl,a(c)},d)})}}]),angular.module("ngSharepoint.Users").provider("$spUser",["$q","$sp","SPUser",function(a,b,c){return{$get:["$q","$sp",function(a,b){return{getCurrentUser:function(){return a(function(a,c){var d=b.getContext(),e=new SP.UserProfiles.PeopleManager(d),f=e.getMyProperties();d.load(f),d.executeQueryAsync(function(){a(f)},c)})},getUser:function(a){return new c(a)}}}]}}]);