angular.module("ngSharepoint",[]).run(["$sp","$spLoader",function(a,b){a.getAutoload()&&("JSOM"===a.getConnectionMode()?(b.loadScript("SP.Runtime.js"),b.loadScript("SP.js")):"REST"!==a.getConnectionMode()||a.getAccessToken||b.loadScript("SP.RequestExecutor.js"))}]),angular.module("ngSharepoint").factory("CamlBuilder",["CamlTag",function(a){var b=function(){this.caml=[]};return b.prototype.push=function(b,c,d){var e;return e=b instanceof a?b:new a(b,c,d),this.caml.push(e),e},b.prototype.findByName=function(a){var b=[];return this.caml.forEach(function(c){c.name===a&&b.push(c)}),b},b.prototype.build=function(){for(var a=0;a<this.caml.length;a++)this.caml[a]=this.caml[a].build();return this.caml.join("")},b}]),angular.module("ngSharepoint").factory("CamlTag",function(){var a=function(a,b,c){this.name=a,this.attr=b||{},this.value=c,this.caml=[]};return a.prototype.__buildTag=function(){var a=this,b="<";return b+=a.name,Object.getOwnPropertyNames(a.attr).length>0&&Object.getOwnPropertyNames(a.attr).forEach(function(c){b+=" ",b+=c,b+="=",b+='"'+a.attr[c]+'"'}),0===this.caml.length&&angular.isUndefined(this.value)?b+="/>":(b+=">",angular.isDefined(this.value)&&(b+=this.value)),b},a.prototype.push=function(b,c,d){var e;return e=b instanceof a?b:new a(b,c,d),this.caml.push(e),e},a.prototype.setValue=function(a){this.value=a},a.prototype.build=function(){for(var a=this.__buildTag(),b=0;b<this.caml.length;b++)a+=this.caml[b].build();return(this.caml.length>0||angular.isDefined(this.value))&&(a+="</"+this.name+">"),a},a}),angular.module("ngSharepoint").factory("$spCamlParser",function(){var a=function(a){var b=this;b.viewFields=[],b.query=a,b.where={},b.orderBy=[],b.limit=-1,b.doc=(new DOMParser).parseFromString(a,"text/xml");var c=b.doc.getElementsByTagName("ViewFields");if(1===c.length)for(var d=c[0].getElementsByTagName("FieldRef"),e=0;e<d.length;e++){var f=d[e];b.viewFields.push(f.attributes.Name.value)}var g=b.doc.getElementsByTagName("Query");if(1===g.length)for(var h=g[0],i=0;i<h.childNodes.length;i++){var j=h.childNodes[i];("Where"===j.nodeName||"And"===j.nodeName||"Or"===j.nodeName)&&b.__parseWhere(j,b.where)}var k=b.doc.getElementsByTagName("RowLimit");return 1===k.length&&(b.limit=parseInt(k[0].childNodes[0].nodeValue)),b};return a.prototype.__parseWhere=function(a,b){var c=this,d={};if("Where"===a.nodeName){var e=a.childNodes[0];d.operator=e.nodeName,d.column=e.getElementsByTagName("FieldRef")[0].attributes.Name.value,d.value=e.getElementsByTagName("Value")[0].childNodes[0].nodeValue}else if("And"===a.nodeName||"Or"===a.nodeName){d.concat=a.nodeName,d.queries=[];for(var f=0;f<a.childNodes.length;f++)c.__parseWhere(a.childNodes[f],d.queries)}Array.isArray(b)?b.push(d):Object.getOwnPropertyNames(d).forEach(function(a){b[a]=d[a]})},a.prototype.getViewFields=function(){return this.viewFields},a.prototype.hasViewFields=function(){return this.viewFields.length>0},a.prototype.getWhere=function(){return this.where},a.prototype.hasWhere=function(){return null!==this.where&&void 0!==this.where&&Object.getOwnPropertyNames(this.where)>0},a.prototype.getLimit=function(){return this.limit},a.prototype.hasLimit=function(){return null!==this.limit&&void 0!==this.limit&&!isNaN(this.limit)&&this.limit>=0},a.prototype.getQuery=function(){return this.query},{parse:function(b){return new a(b)}}}),angular.module("ngSharepoint").factory("SPContext",["$q","$sp",function(a,b){var c=function(){this.context=b.getContext()};return c.prototype.getLists=function(){var b=this;return a(function(a,c){var d=b.context.get_web().get_lists();b.context.load(d),b.context.executeQueryAsync(function(a,b){for(var c=d.getEnumerator();c.moveNext();){d.get_current()}})})},c}]),angular.module("ngSharepoint").factory("$spLoader",["$q","$http","$sp",function(a,b,c){var d={};return{loadScript:function(b){var c=a(function(a,c){var d=document.createElement("script");d.type="text/javascript",d.src="_layouts/15/"+b,d.onload=a,d.onerror=c});return d[b]=c,c},waitUntil:function(a){return query[url]},query:function(d){var e={url:c.getSiteUrl()+d.url,method:d.method,headers:{Accept:"application/json; odata=verbose","Content-Type":"application/json; odata=verbose"}};return a("REST"!==c.getConnectionMode()||c.getAccessToken()?function(a,f){e.data=d.data,e.headers.Authorization="Bearer "+c.getAccessToken,b(e).then(a,f)}:function(a,b){e.body=d.data,e.success=a,e.error=b,new SP.RequestExecutor(c.getSiteUrl()).executeAsync(e)})}}}]),angular.module("ngSharepoint").provider("$spLog",function(){var a="[ngSharepoint] ",b=!0;return{setPrefix:function(a){this.prefix="["+a+"] "},setEnabled:function(a){this.enabled=a},$get:function(){return{error:function(c){b&&("object"==typeof c?console.error(a+"Object: %O",c):console.error(a+c))},warn:function(c){b&&("object"==typeof c?console.warn(a+"Object: %O",c):console.warn(a+c))},log:function(c){b&&("object"==typeof c?console.log(a+"Object: %O",c):console.log(a+c))}}}}}),angular.module("ngSharepoint").provider("$sp",function(){var a="",b="JSOM",c=!0;return{setSiteUrl:function(b){a=b},setConnectionMode:function(a){("JSOM"===a||"REST"===a)&&(this.connMode=a)},setAccessToken:function(a){this.token=a},setAutoload:function(a){this.autoload=a},$get:function(){return{getSiteUrl:function(){return a},getConnectionMode:function(){return b},getAccessToken:function(a){return a},getContext:function(){return new SP.ClientContext(a)},getAutoload:function(){return c}}}}});