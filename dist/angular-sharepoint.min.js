angular.module("ngSharepoint",[]),angular.module("ngSharepoint").factory("DeleteQuery",["$q","$sp","WhereQuery","Query",function(a,b,c,d){var e=function(){return this.__where=[],this.__list=null,this};return e.prototype=new d,e.prototype.from=function(a){return this.__list=a,this},e.prototype.where=function(a){var b=new c(this,a);return this.__where.push(b),b},e.prototype.__execute=function(){var c=this;return a(function(a,d){var e=b.getContext(),f=e.get_web().get_lists().getByTitle(c.__list),g=new SP.CamlQuery,h=["<View>"];1===c.__where.length?(h.push("<Query>"),h.push("<Where>"),c.__where[0].push(h),h.push("</Where>"),h.push("</Query>")):c.__where.length>1&&(h.push("<Query>"),h.push("<Where>"),h.push("<And>"),c.__where.forEach(function(a){a.push(h)}),h.push("</And>"),h.push("</Where>"),h.push("</Query>")),h.push("</View>"),g.set_viewXml(h.join(""));var i=f.getItems(g);e.load(i),e.executeQueryAsync(function(b,c){for(var f=i.getEnumerator(),g=[];f.moveNext();){var h=f.get_current();g.push(h)}g.forEach(function(a){a.deleteObject()}),e.executeQueryAsync(function(b,c){a(c)},function(a,b){d(b)})},function(a,b){d(b)})})},e}]),angular.module("ngSharepoint").factory("InsertIntoQuery",["$q","$sp","Query",function(a,b,c){var d=function(a){return this.__list=a,this.__values={},this};return d.prototype=new c,d.prototype.value=function(a,b){return this.__values[a]=b,this},d.prototype.__execute=function(){var c=this;return a(function(a,d){var e=b.getContext(),f=e.get_web().get_lists().getByTitle(c.__list),g=new SP.ListItemCreationInformation,h=f.addItem(g);c.packItem(h),h.update(),e.load(h),e.executeQueryAsync(function(b,d){a(c.unpackItem(h))},function(a,b){d(b)})})},d}]),angular.module("ngSharepoint").factory("JoinQuery",["$q","$sp",function(a,b){var c=function(){};return c}]),angular.module("ngSharepoint").factory("Query",function(){var a=function(){};return a.prototype.unpackItem=function(a){var b=this,c={};return Array.isArray(b.__values)?b.__values.forEach(function(d){var e=a.get_item(d);c[d]=b.__trim(e)}):Object.getOwnPropertyNames(b.__values).forEach(function(d){var e=a.get_item(d);c[d]=b.__trim(e)}),c},a.prototype.packItem=function(a){var b=this;Object.getOwnPropertyNames(b.__values).forEach(function(c){a.set_item(c,b.__trim(b.__values[c]))})},a.prototype.then=function(a,b){return this.__execute().then(a,b)},a.prototype.__trim=function(a){return null!==a&&void 0!==a&&"string"==typeof a?a.trim():a},a}),angular.module("ngSharepoint").factory("SelectQuery",["$q","$sp","Query","WhereQuery",function(a,b,c,d){var e=function(a){return this.__values=a,this.__where=[],this.__limit=null,this};return e.prototype=new c,e.prototype.from=function(a){return this.__list=a,this},e.prototype.where=function(a){var b=new d(this,a);return this.__where.push(b),b},e.prototype.limit=function(a){return this.__limit=a,this},e.prototype.__execute=function(){var c=this;return a(function(a,d){var e=b.getContext(),f=e.get_web().get_lists().getByTitle(c.__list),g=new SP.CamlQuery,h=["<View>"];1===c.__where.length?(h.push("<Query>"),h.push("<Where>"),c.__where[0].push(h),h.push("</Where>"),h.push("</Query>")):c.__where.length>1&&(h.push("<Query>"),h.push("<Where>"),h.push("<And>"),c.__where.forEach(function(a){a.push(h)}),h.push("</And>"),h.push("</Where>"),h.push("</Query>")),h.push("<ViewFields>"),c.__values.forEach(function(a){h.push('<FieldRef Name="'+a+'"/>')}),h.push("</ViewFields>"),null!==c.__limit&&h.push("<RowLimit>"+c.__limit+"</RowLimit>"),h.push("</View>"),g.set_viewXml(h.join(""));var i=f.getItems(g);e.load(i),e.executeQueryAsync(function(b,d){for(var e=[],f=i.getEnumerator();f.moveNext();){var g=f.get_current();e.push(c.unpackItem(g))}a(e)},function(a,b){d(b)})})},e}]),angular.module("ngSharepoint").factory("UpdateQuery",["$q","$sp","WhereQuery","Query",function(a,b,c,d){var e=function(a){return this.__list=a,this.__values={},this.__where=[],this};return e.prototype=new d,e.prototype.set=function(a,b){return this.__values[a]=b,this},e.prototype.where=function(a){var b=new c(this,a);return this.__where.push(b),b},e.prototype.__execute=function(){var c=this;return a(function(a,d){var e=b.getContext(),f=e.get_web().get_lists().getByTitle(c.__list),g=new SP.CamlQuery,h=["<View>"];1===c.__where.length?(h.push("<Query>"),h.push("<Where>"),c.__where[0].push(h),h.push("</Where>"),h.push("</Query>")):c.__where.length>1&&(h.push("<Query>"),h.push("<Where>"),h.push("<And>"),c.__where.forEach(function(a){a.push(h)}),h.push("</And>"),h.push("</Where>"),h.push("</Query>")),h.push("</View>"),g.set_viewXml(h.join(""));var i=f.getItems(g);e.load(i),e.executeQueryAsync(function(b,f){for(var g=i.getEnumerator();g.moveNext();){var h=g.get_current();c.packItem(h),h.update()}e.executeQueryAsync(function(b,c){a(c)},function(a,b){d(b)})},function(a,b){d(b)})})},e}]),angular.module("ngSharepoint").factory("WhereQuery",function(){var a=function(a,b){this.__query=a,this.__field=b,this.__value="",this.__operator="",this.__operators={BEGINS_WITH:["<BeginsWith>","</BeginsWith>"],CONTAINS:["<Contains>","</Contains>"],EQUALS:["<Eq>","</Eq>"],GREATER_EQUALS:["<Geq>","</Geq>"],GREATER:["<Gt>","</Gt>"],INCLUDES:["<Includes>","</Includes>"],IS_NOT_NULL:["<IsNotNull>","</IsNotNull>"],IS_NULL:["<IsNull>","</IsNull>"],LESS_EQUALS:["<Leq>","</Leq>"],LESS:["<Lt>","</Lt>"],NOT_EQUALS:["<Neq>","</Neq>"],NOT_INCLUDES:["<NotIncludes>","</NotIncludes>"]}};return a.prototype.equals=function(a){return this.__operator="equals",this.__value=a,this.__query},a.prototype.beginsWith=function(a){this.__operator=this.__operators.BEGINS_WITH},a.prototype.push=function(a){switch(this.__operator){case"equals":a.push("<Eq>")}switch(a.push('<FieldRef Name="'+this.__field+'"/>'),a.push('<Value Type="Number">'+this.__value+"</Value>"),this.__operator){case"equals":a.push("</Eq>")}},a}),angular.module("ngSharepoint").factory("CamlBuilder",["CamlTag",function(a){var b=function(){this.camlQuery=new SP.CamlQuery,this.caml=[]};return b.prototype.push=function(b,c){if(b instanceof a)this.caml.push(b);else{var d=new a(b,c);this.caml.push(d)}},b.prototype.findByTag=function(a){var b=[];return this.caml.forEach(function(c){c.tag==a&&b.push(c)}),b},b.prototype.build=function(){for(var a=0;0>a;a++)this.caml[a]=this.caml[a].build();return this.camlQuery.set_viewXml(this.caml.join[""]),this.camlQuery},b}]),angular.module("ngSharepoint").factory("CamlTag",function(){var a=function(a,b,c){this.name=a,this.attr=b||{},this.value=c||void 0,this.caml=[]};return a.prototype.__buildTag=function(){var a=this,b="<";return b+=a.name,Object.getOwnPropertyNames(a.attr).length>0&&Object.getOwnPropertyNames(a.attr).forEach(function(c){b+=" ",b+=c,b+="=",b+='"'+a.attr[c]+'"'}),0===this.caml.length&&angular.isUndefined(this.value)?b+="/>":(b+=">",angular.isDefined(this.value)&&(b+=this.value)),b},a.prototype.push=function(b,c){if(b instanceof a)this.caml.push(b);else{var d=new a(b,c);this.caml.push(d)}},a.prototype.setVal=function(a){this.value=a},a.prototype.build=function(){for(var a=this.__buildTag(),b=0;b<this.caml.length;b++)a+=this.caml[b].build();return(this.caml.length>0||angular.isDefined(this.value))&&(a+="</"+this.name+">"),a},a}),angular.module("ngSharepoint").factory("$spList",["$sp","SelectQuery","UpdateQuery","InsertIntoQuery","DeleteQuery",function(a,b,c,d,e){return{select:function(a){return new b(a)},update:function(a){return new c(a)},insertInto:function(a){return new d(a)},"delete":function(){return new e}}}]),angular.module("ngSharepoint").provider("$sp",function(){var a="";return{setSiteUrl:function(b){a=b},$get:function(){return{getSiteUrl:function(){return a},getContext:function(){return new SP.ClientContext(a)}}}}});