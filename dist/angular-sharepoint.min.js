function $spProvider(){function a(a){if(!angular.isDefined(a)||!angular.isString(a))throw"Invalid Argument Exception";h=a}function b(a){if(!angular.isDefined(a)||!angular.isString(a))throw"Invalid Argument Exception";g=a}function c(a){if(!angular.isDefined(a)||!angular.isString(a))throw"Invalid Argument Exception";if(a=a.toUpperCase(),"JSOM"!==a&&"REST"!==a)throw"Invalid Argument Exception";i=a}function d(a){if(!angular.isDefined(a)||!angular.isString(a))throw"Invalid Argument Exception";j=a}function e(a){if(!angular.isDefined(a))throw"Invalid Argument Exception";if(a!==!0&&a!==!1)throw"Invalid Argument Exception";k=a}function f(){function a(){return new SP.ClientContext}function b(){return g}function c(){return h}function d(){return i}function e(){return j}function f(){return k}var l={getSiteUrl:b,getHostUrl:c,getConnectionMode:d,getAccessToken:e,getContext:a,getAutoload:f};return l}var g,h,i="JSOM",j=!1,k=!0,l={setSiteUrl:b,setHostUrl:a,setConnectionMode:c,setAccessToken:d,setAutoload:e,$get:f};return l}angular.module("ngSharepoint",[]).run(["$sp","$spLoader",function(a,b){if(a.getAutoload())if("JSOM"===a.getConnectionMode()){var c=["//ajax.aspnetcdn.com/ajax/4.0/1/MicrosoftAjax.js","SP.Runtime.js","SP.js"];b.loadScripts("SP.Core",c)}else"REST"!==a.getConnectionMode()||a.getAccessToken()||b.loadScript("SP.RequestExecutor.js")}]),angular.module("ngSharepoint").factory("CamlBuilder",["CamlTag",function(a){var b=function(){this.caml=[]};return b.prototype.push=function(b,c,d){var e;return e=b instanceof a?b:new a(b,c,d),this.caml.push(e),e},b.prototype.findByName=function(a){var b=[];return this.caml.forEach(function(c){c.name===a&&b.push(c)}),b},b.prototype.isEmpty=function(){if(0===this.caml.length)return!0;if(1===this.caml.length){var a=this.caml[0];return angular.isDefined(a.value)?!1:angular.isDefined(a.caml)&&angular.isArray(a.caml)&&a.caml.length>0?!1:angular.isDefined(a.attr)&&angular.isObject(a.attr)&&Object.getOwnPropertyNames(a.attr).length>0?!1:!0}return!1},b.prototype.build=function(){for(var a=0;a<this.caml.length;a++)this.caml[a]=this.caml[a].build();return this.caml.join("")},b.prototype.buildFromJson=function(a){if(angular.isDefined(a)&&angular.isObject(a)){var b=this.findByName("View");b=0===b.length?this.push("View"):b[0],angular.isDefined(a.columns)&&this.__buildViewFields(a.columns,b),angular.isDefined(a.query)&&this.__buildQuery(a.query,b),angular.isDefined(a.limit)&&this.__buildLimit(a.limit,b),angular.isDefined(a.order)&&a.order.length>0&&this.__buildOrder(a.order,b)}},b.prototype.__buildViewFields=function(a,b){var c=b.push("ViewFields");a.forEach(function(a){c.push("FieldRef",{Name:a})})},b.prototype.__buildQuery=function(a,b){var c=this;if("View"===b.name&&(b=b.push("Query").push("Where")),angular.isDefined(a.concat)){var d;if("and"===a.concat)d=b.push("And");else{if("or"!==a.concat)throw"Invalid Query";d=b.push("Or")}a.queries.forEach(function(a){c.__buildQuery(a,d)})}else{if(!angular.isDefined(a.comparator))throw"Invalid Query";a.comparator=a.comparator.toLowerCase();var e;switch(a.comparator){case"beginswith":e=b.push("BeginsWith");break;case"contains":e=b.push("Contains");break;case"daterangesoverlap":e=b.push("DateRangesOverlap");break;case"==":case"eq":case"equals":e=b.push("Eq");break;case">=":case"geq":case"greaterequals":e=b.push("Geq");break;case">":case"gt":case"greater":e=b.push("Gt");break;case"in":e=b.push("In");break;case"includes":e=b.push("Includes");break;case"isnotnull":e=b.push("IsNotNull");break;case"isnull":e=b.push("IsNull");break;case"<=":case"leq":case"lessequals":e=b.push("Leq");break;case"<":case"lt":case"less":e=b.push("Lt");break;case"!=":case"neq":case"notequals":e=b.push("Neq");break;case"notincludes":e=b.push("NotIncludes")}e.push("FieldRef",{Name:a.column}),angular.isDefined(a.value)&&e.push("Value",{},a.value)}},b.prototype.__buildLimit=function(a,b){b.push("RowLimit",{},a)},b.prototype.__buildOrder=function(a,b){var c=b.findByName("Query");c=0===c.length?b.push("Query"):c[0];var d=c.push("OrderBy");a.forEach(function(a){if(!angular.isDefined(a.column))throw"Invalid Order Query";var b=!0;angular.isDefined(a.asc)&&(b=a.asc),b=b.toString().toUpperCase(),d.push("FieldRef",{Name:a.column,Ascending:b})})},b}]),angular.module("ngSharepoint").factory("$spCamlParser",function(){var a=function(a){var b=this;b.viewFields=[],b.query=a,b.where={},b.orderBy=[],b.limit=-1,b.doc=(new DOMParser).parseFromString(a,"text/xml");var c=b.doc.getElementsByTagName("ViewFields");if(1===c.length)for(var d=c[0].getElementsByTagName("FieldRef"),e=0;e<d.length;e++){var f=d[e];b.viewFields.push(f.attributes.Name.value)}var g=b.doc.getElementsByTagName("Query");if(1===g.length)for(var h=g[0],i=0;i<h.childNodes.length;i++){var j=h.childNodes[i];("Where"===j.nodeName||"And"===j.nodeName||"Or"===j.nodeName)&&b.__parseWhere(j,b.where)}var k=b.doc.getElementsByTagName("RowLimit");return 1===k.length&&(b.limit=parseInt(k[0].childNodes[0].nodeValue)),b};return a.prototype.__parseWhere=function(a,b){var c=this,d={};if("Where"===a.nodeName){var e=a.childNodes[0];d.operator=e.nodeName,d.column=e.getElementsByTagName("FieldRef")[0].attributes.Name.value,d.value=e.getElementsByTagName("Value")[0].childNodes[0].nodeValue}else if("And"===a.nodeName||"Or"===a.nodeName){d.concat=a.nodeName,d.queries=[];for(var f=0;f<a.childNodes.length;f++)c.__parseWhere(a.childNodes[f],d.queries)}angular.isArray(b)?b.push(d):Object.getOwnPropertyNames(d).forEach(function(a){b[a]=d[a]})},a.prototype.getViewFields=function(){return this.viewFields},a.prototype.hasViewFields=function(){return this.viewFields.length>0},a.prototype.getWhere=function(){return this.where},a.prototype.hasWhere=function(){return angular.isDefined(this.where)&&null!==this.where&&Object.getOwnPropertyNames(this.where)>0},a.prototype.getLimit=function(){return this.limit},a.prototype.hasLimit=function(){return angular.isDefined(this.where)&&null!==this.limit&&!isNaN(this.limit)&&this.limit>=0},a.prototype.getQuery=function(){return this.query},{parse:function(b){return new a(b)}}}),angular.module("ngSharepoint").factory("CamlTag",function(){var a=function(a,b,c){this.name=a,this.attr=b||{},this.value=c,this.caml=[]};return a.prototype.__buildTag=function(){var a=this,b="<";return b+=a.name,Object.getOwnPropertyNames(a.attr).length>0&&Object.getOwnPropertyNames(a.attr).forEach(function(c){b+=" ",b+=c,b+="=",b+='"'+a.attr[c]+'"'}),0===this.caml.length&&angular.isUndefined(this.value)?b+="/>":(b+=">",angular.isDefined(this.value)&&(b+=this.value)),b},a.prototype.findByName=function(a){var b=[];return this.caml.forEach(function(c){c.name===a&&b.push(c)}),b},a.prototype.push=function(b,c,d){var e;return e=b instanceof a?b:new a(b,c,d),this.caml.push(e),e},a.prototype.setValue=function(a){this.value=a},a.prototype.build=function(){for(var a=this.__buildTag(),b=0;b<this.caml.length;b++)a+=this.caml[b].build();return(this.caml.length>0||angular.isDefined(this.value))&&(a+="</"+this.name+">"),a},a}),angular.module("ngSharepoint").provider("$sp",$spProvider),angular.module("ngSharepoint").factory("$spLoader",["$q","$http","$sp","$spLog",function(a,b,c,d){var e={},f={};return f.loadScript=function(b){var d=a(function(a,d){var e=document.createElement("script");e.type="text/javascript",b[0]===b[1]&&"/"===b[0]?e.src=b:e.src=c.getSiteUrl()+"_layouts/15/"+b,e.onload=a,e.onerror=d,document.head.appendChild(e)});return e[b]=d,d},f.loadScripts=function(b,c){var d=[];c.forEach(function(a){d.push(f.loadScript(a))});var g=a.all(d);return e[b]=g,g},f.waitUntil=function(b){return a(function(a,d){e.hasOwnProperty(b)?e[b].then(a,d):c.getAutoload()?d("Library was not requested"):a()})},f.query=function(b){return a(function(a,d){var e={url:c.getSiteUrl()+b.url,method:b.method,headers:{Accept:"application/json; odata=verbose","Content-Type":"application/json; odata=verbose"}};f.waitUntil("SP.RequestExecutor.js").then(function(){b.hasOwnProperty("data")&&angular.isDefined(b.data)&&null!==b&&(e.body=b.data),e.success=a,e.error=d,new SP.RequestExecutor(c.getSiteUrl()).executeAsync(e)})})["catch"](d.error)},f}]),angular.module("ngSharepoint").provider("$spLog",function(){var a="[ngSharepoint] ",b=!0;return{setPrefix:function(a){this.prefix="["+a+"] "},setEnabled:function(a){this.enabled=a},$get:function(){return{error:function(c){b&&(angular.isObject(c)?console.error(a+"Object: %O",c):console.error(a+c))},warn:function(c){b&&(angular.isObject(c)?console.warn(a+"Object: %O",c):console.warn(a+c))},log:function(c){b&&(angular.isObject(c)?console.log(a+"Object: %O",c):console.log(a+c))}}}}});